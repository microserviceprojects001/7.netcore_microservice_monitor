# 文档

https://zipkin.io/pages/tracers_instrumentation.html

# slim 和 openzipkin/zipkin 版本对比

如果你只是快速启动一个 Zipkin 服务器进行测试，并且不需要持久化存储（使用内存），那么两个都可以，但 slim 版本更小，启动可能更快。

如果你需要连接到 MySQL、Elasticsearch 等外部存储，并且不想自己安装额外的驱动程序，那么使用完整版 openzipkin/zipkin 会更方便

# 先下载镜像

git:
https://github.com/openzipkin-attic/docker-zipkin
https://github.com/openzipkin/zipkin # 这个地址是官方的

https://github.com/AbelLiuKai/docker_image_pusher/blob/main/images.txt

写入:openzipkin/zipkin

需要等一会儿就可以在阿里云中出现了

https://cr.console.aliyun.com/cn-hangzhou/instance/repositories

docker login --username=abelliu001 registry.cn-hangzhou.aliyuncs.com
docker pull registry.cn-hangzhou.aliyuncs.com/abelcontainer/zipkin

docker run -d -p 9411:9411 registry.cn-hangzhou.aliyuncs.com/abelcontainer/zipkin

# 阿里云上需要打开安全组端口号

本地和阿里云服务器上的都可以访问了：
http://8.140.59.193:9411/zipkin/
http://localhost:9411/zipkin/

# 代码配置

dotnet add package OpenTelemetry
dotnet add package OpenTelemetry.Exporter.Zipkin
dotnet add package OpenTelemetry.Extensions.Hosting
dotnet add package OpenTelemetry.Instrumentation.AspNetCore
dotnet add package OpenTelemetry.Instrumentation.Http

# 遗留问题

是数据的存储是要使用 mysql，还是 Elastic search

此是代码进行了一些修改是能够做到跟踪 请求了，

# 其中比较关键的点是 httpclient 的创建方式，必须要走 httpClientFactory 才可以，否则个跟踪无效

```
_httpClient = httpClientFactory.CreateClient(name);

```

以及

```

builder.Services.AddHttpClient("User.Identity");
```

name 必须匹配

以及

```
tracerProviderBuilder.SetSampler(new AlwaysOnSampler());
```

也是必须得
