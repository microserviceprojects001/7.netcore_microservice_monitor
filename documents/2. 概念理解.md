# Elastic Search 概念理解

我现在的问题有很多，elastic Search 是以很多个容器的方式部署到 K8s 集群中的吗，好，现在各个容器，你的意思是是说有协调容器，主分片容器吗，副本篇容器吗。然后你提到的节点 ，主分片节点是 K8S 里的 worker 节点吗，副本节点也是 worker 节点吗，我觉得 这些概念有些混淆

# 就是说 K8S 的容器，会有 Master 节点的容器，和 Data 节点的容器，其中 Data 节点的容器中可能会有主分片数据 和 副本分片数据，

# 一个 Pod 被配置为【专用主节点】

node.roles: [ 'master' ] # 只承担管理职责，不存数据

# 一个 Pod 被配置为【专用数据节点】

node.roles: [ 'data' ] # 只承担数据存储和计算，不参与集群管理，

# 这个请求的完整生命周期如下图所示，它清晰地展示了数据如何在不同角色的容器间流转与复制：

![alt text](<../截图/0. 数据流转.png>)

流程详解：

1. 接收请求：请求发到 es-data1 的 9201 端口。此时，es-data1 自动担任 “协调节点”。

2. 路由决策：es-data1 询问集群的“大脑”（主节点 es-master）：“my_index 的数据应该写在哪个分片？主分片在谁那？”（实际使用哈希算法计算分片号）。

3. 转发请求：得知主分片在 es-data2 上，es-data1 通过容器间网络（9300 端口）将请求内部转发给 es-data2。

4. 本地写入：es-data2 作为主分片持有者，将数据写入其本地存储。

5. 并行复制：es-data2 同时将数据通过 9300 端口转发给副本分片的持有者（假设就是 es-data1 自己）。

6. 副本写入：es-data1 将数据写入其本地副本。

7. 确认返回：所有副本确认后，es-data2 告知 es-data1（协调节点）写入成功，最终将成功响应返回给你的客户端。
